"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[282],{2773:function(e,t,n){var r=n(5893);n(7294),t.Z=()=>(0,r.jsx)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",backgroundColor:"transparent",color:"#000"},className:"loading",children:(0,r.jsx)("img",{width:50,src:"https://media.tenor.com/On7kvXhzml4AAAAi/loading-gif.gif"})})},8989:function(e,t,n){n.d(t,{o:function(){return r}});let r="59f13fc54a57ee4a7442365c7d550b4b"},6487:function(e,t,n){n.d(t,{g:function(){return u},l:function(){return s}});var r,o,i=n(2893);(r=o||(o={})).FLOW_TRANSITION_EVENT="flow-transition-event",r.REDIRECT_EVENT="redirect-event",r.EXECUTE_ACTION="execute-action",r.EXIT_FLOW="exit-flow";let a=i.Zt+"/sdk-error-screens",s={500:"".concat(a,"/internal_server_error.svg"),404:"".concat(a,"/campaign_not_found.svg"),403:"".concat(a,"/forbidden.svg"),401:"".concat(a,"/unauthorized.svg"),400:"".concat(a,"/bad_request.svg")},u=o},2893:function(e,t,n){n.d(t,{HG:function(){return a},MS:function(){return o},Zs:function(){return u},Zt:function(){return c},fi:function(){return i},fy:function(){return s},rN:function(){return r}});let r="https://sandbox.niti.ai/weber/v1/sdk",o=r+"/execute-flow",i="https://sandbox.niti.ai/cta/api/analytics",a=r+"/render-pod",s=r+"/configurations",u=r+"/execute-actions",c="https://loop-niti-assets.s3.ap-south-1.amazonaws.com"},8300:function(e,t,n){n.d(t,{Mn:function(){return d},NA:function(){return u},Wu:function(){return c}});var r=n(8989),o=n(3434),i=n(1876).Buffer,a=n(2474);let s=e=>{let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.substring(n,n+2),16));return i.from(t)},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{let t=r.o,n=i.from(t,"utf-8"),o=s(e),u=o.slice(0,12),c=o.slice(-16),l=o.slice(12,-16),d=a.createDecipheriv("aes-256-gcm",n,u);d.setAuthTag(c);let f=d.update(l);return(f=i.concat([f,d.final()])).toString()}catch(e){throw console.error("Decryption failed:",e),e}},c=(e,t)=>{try{let n=i.from(t,"utf-8"),r=a.randomBytes(12),o=a.createCipheriv("aes-256-gcm",n,r),s=o.update(e,"utf8","hex");s+=o.final("hex");let u=o.getAuthTag();return r.toString("hex")+s+u.toString("hex")}catch(e){throw console.error("Encryption failed:",e),e}},l=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return((null===(e=function(e){let t=e.split(".");return{header:JSON.parse(atob(t[0])),payload:JSON.parse(atob(t[1])),signature:t[2]}}(n).payload)||void 0===e?void 0:e.userId)||"")===t},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="",n="",r="",i="",a="";try{t=u(e)}catch(e){throw e}return(t&&(n=(0,o.PO)(t),r=(0,o.Or)(t),i=(0,o.g2)(t),a=(0,o.dx)(t)),l(r,i))?(localStorage.setItem("accessKey",JSON.stringify(i)),{userId:r,campaignId:n,campaignKey:a}):null}},3434:function(e,t,n){n.d(t,{N2:function(){return S},Op:function(){return D},Or:function(){return E},PO:function(){return m},R$:function(){return U},X3:function(){return I},aj:function(){return w},dx:function(){return y},eL:function(){return O},eh:function(){return p},fG:function(){return u},g2:function(){return N},gy:function(){return v},hr:function(){return c},i6:function(){return T},wm:function(){return d},zX:function(){return l}});var r=n(2893),o=n(8300),i=n(8989),a=n(1833),s=n(6487);let u=(e,t,n,r,o)=>{let{flowId:i,nodeID:a,inputParams:s,sessionId:u}=e,{action:c,...l}=n,d={...l,...s,userID:t,userId:t,flowId:i,podId:r,campaignKey:o,sessionId:u,lastLumenRequestTimeStamp:Date.now()};return JSON.stringify({flow_id:Number(i),user_id:t,node_id:a,campaign_key:o,event:{type:"transition",...d}})},c=e=>{let{action:t,...n}=null==e?void 0:e.inputParams;return JSON.stringify({actions:t,contextParams:n})},l=e=>{let t="";for(let n in e){let r=JSON.stringify(e[n]);"string"==typeof n&&(t+="var ".concat(n," = ").concat(r,";\n"))}return t},d=(e,t)=>e.find(e=>e===t),f=(e,t,n)=>{let o=null,i=null;"SDK"===n?(o=t,i=e):(o="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI5YjY5Njk1MS04Zjk1LTQ5ZDItYWVhZS04ZDU4OGVkYmI2YTkifQ.B4X06Me4F3QU6JnxIaUm1i7RrilTP7jEZm-M2BrOo-YrTXQBLoDg7B7Gh2W444ePt87fp8V3BthdL0ofOPB2nuYSOv2wfyd8F_cR51PZ1eYLgXvxEUTW1cB7rFZoeRUjVPQHvw5qMxXObss4K9yf-VaDBfJUQ5yLu6rc9qlqzsMSun_ZiuYeuFQU9IxufJkIADsHUVnELNEWvMZLodUhPOQ_XnHm6WpHgdXvwbkuO3f5RlqV3vnRXXHZ3S7LF4O5garsz6KTk7CGUaz6sTGIK0Hf9KtFiodormGFxbVU7EAzpCCoQxl7Ieyi5wwMY33-j1Pc_1PKrOBuBkNtTFYeGw",i=JSON.parse(localStorage.getItem("accessKey")));let a={accessKey:"Bearer ".concat(i),userAuthToken:"Bearer ".concat(o)};return"\n    function _sdk_function_postMessage(message) { \n     return window.parent.postMessage(message);\n    }\n  "+'\n    function _sdk_function_uploadDocument(requestOptions) { \n      return fetch("'.concat(r.rN,'/upload-document", {\n        ...requestOptions,\n        headers: ').concat(JSON.stringify(a),"\n      }).then((response) => response)\n      .catch(error =>console.log('error', error));\n    }\n  ")+'\n    function _sdk_function_getS3Url(requestOptions) {\n        return fetch("'.concat(r.rN,"/get-s3-url?\"+new URLSearchParams(requestOptions), {\n            method: 'GET',\n            headers: ").concat(JSON.stringify(a),"\n        }).then((response) => response)\n        .catch(error => console.log('error', error));\n    }\n  ")},g=(e,t)=>e.replace(/<\/body>(?![\s\S]*<\/body>)/,t),p=(e,t,n,r,o)=>(t+=f(n,r,o),e?g(e,"<script defer >".concat(t,";</script></body>")):""),v=(e,t,n,r,o,i,a)=>{let s=e=>h(e,t,n,r,o,i,a);return e.addEventListener("message",s),()=>{e.removeEventListener("message",s)}},h=(e,t,n,r,o,i,s)=>{let u;if("string"==typeof e.data)try{u=JSON.parse(e.data)}catch(t){u=e.data}else u=e.data;a.Z.debug("DEBUG_LUMEN- Event inside:",JSON.stringify(u)),L(u)&&(a.Z.debug("DEBUG_LUMEN-INSIDE ANUMATI EVENTS TRUE",e),T({eventData:u})),(null==u?void 0:u.source)===t&&b(u,n,r,o,i,s)},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.match(/campaignId=([^&]+)/);return t&&t[1]?t[1]:null},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.match(/userId=([^&]+)/);return t&&t[1]?t[1]:null},y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.match(/campaignKey=([^&]+)/);return t&&t[1]?t[1]:null},N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.match(/token=([^&]+)/)?e.match(/token=([^&]+)/)[1]:""},O=(e,t,n,r,o,i)=>{let a=e=>{_(e,t,n,r,o,i)};return e.addEventListener("message",a),()=>{e.removeEventListener("message",a)}},_=(e,t,n,r,o,i)=>{let a="string"==typeof e.data?JSON.parse(e.data):e.data;if((null==a?void 0:a.source)===t)b(a,n,r,null,null,null,t,i);else if("LUMEN"===a.source){let{source:e,...t}=a;R(JSON.stringify(t)),"ON_FLOW_RESIZE"===t.eventName&&o(t.params.height)}},S=e=>JSON.parse(e),w=e=>{try{var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(e){throw e}},I=async e=>{let{userId:t,accessKey:n,userAuthToken:r,flowId:a,params:s}=e,u="loopFlow?campaignId=".concat(a,"&params=").concat(encodeURIComponent(JSON.stringify(s))),c=(0,o.Wu)(JSON.stringify({"x-access-key":n,"x-user-id":t,"x-user-auth-token":r}),i.o);return u+"&headerPayload=".concat(c,"&entry=query&dismissAllowed=false")},T=e=>{a.Z.debug("DEBUG_LUMEN HANDLE FLOW REDIRECT",e),window.parent.postMessage({source:"redirect_screen",type:"onReturn",__redirectParams__:e},"*")},L=e=>"anumati-on-complete"===e,U=(e,t)=>{window.SDK?window.SDK.postMessage(JSON.stringify({eventType:"internalLoopEvent",eventName:"ON_FLOW_RESIZE",params:{height:e,origin:t}})):window.parent.postMessage(JSON.stringify({eventType:"internalLoopEvent",eventName:"ON_FLOW_RESIZE",params:{height:e,origin:t}}),"*")},R=e=>{window.SDK?window.SDK.postMessage(e):window.parent.postMessage(e,"*")},b=(e,t,n,r,o,i,u,c)=>{if((null==e?void 0:e.type)===s.g.FLOW_TRANSITION_EVENT)t(null==e?void 0:e.data);else if((null==e?void 0:e.type)===s.g.REDIRECT_EVENT){var l,d,f,g;let t,n;let o=e.data;if(o.redirectUrl)t=o.redirectUrl,n=o.data;else{if(null==e||null===(d=e.data)||void 0===d||null===(l=d.inputParams)||void 0===l||!l.redirectUrl)return;t=null==e?void 0:null===(g=e.data)||void 0===g?void 0:null===(f=g.inputParams)||void 0===f?void 0:f.redirectUrl,n=null==e?void 0:e.data}c?D(t,u):function(e,t,n){let r=document.createElement("iframe");r.style.cssText="width:100%; height:100%; position:fixed; top:0; left:0; z-index:1000; background: #FFFFFF; border: 0;",r.src=e,document.body.appendChild(r);let o=e=>{var i,s,u;if(a.Z.debug("DEBUG_LUMEN-INSIDE REDIRECT MESSAGE HANDLER",e,JSON.stringify(e.data)),(null===(i=e.data)||void 0===i?void 0:i.type)==="onReturn"&&(null===(s=e.data)||void 0===s?void 0:s.source)==="redirect_screen"){a.Z.debug("DEBUG_LUMEN-INSIDE RETURN REDIRECT"),t(n,((null==(u=e.data.__redirectParams__)?void 0:u.action)===""&&(u.action=[]),u));try{window.removeEventListener("message",o),document.body.removeChild(r)}catch(e){a.Z.debug("DEBUG_PLUTO- Error while removing iframe:",e)}}};window.addEventListener("message",o)}(t,r,n)}else(null==e?void 0:e.type)===s.g.EXECUTE_ACTION?o(e.data,event.source):(null==e?void 0:e.type)===s.g.EXIT_FLOW?i.onExit():n({type:e.type,eventType:null==e?void 0:e.eventType})},D=(e,t)=>{if(window.SDK){var n;null===(n=window.SDK)||void 0===n||n.postMessage(JSON.stringify({eventType:"internalLoopEvent",eventName:"ON_FLOW_SWITCH",params:{switchURl:e,origin:t}}))}else window.parent.postMessage(JSON.stringify({eventType:"internalLoopEvent",eventName:"ON_FLOW_SWITCH",params:{switchURl:e,origin:t}}),"*")}},1833:function(e,t,n){var r=n(2043),o=n.n(r);o().setLevel("debug"),t.Z=o().getLogger("logger")}}]);